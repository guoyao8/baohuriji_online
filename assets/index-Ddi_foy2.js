const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/reminder-uOEdt9bX.js","assets/react-vendor-CA3giask.js","assets/store-DH4KNu1b.js","assets/http-B9ygI19o.js","assets/date-utils-BxdteZ_p.js","assets/AddRecord-CHTnfwBc.js","assets/EditRecord-DMVdV1v_.js","assets/Stats-CAZ7fOf6.js","assets/Settings-D3D5oDch.js","assets/BabyProfile-B-Jnxjdp.js","assets/AvatarUpload-KnpHRixg.js","assets/AccountSettings-DHecCGAc.js","assets/ChangePassword-DtBBEHAj.js"])))=>i.map(i=>d[i]);
import{r as d,a as ie,u as ee,B as oe,b as ce,c as j,N as le,R as de}from"./react-vendor-CA3giask.js";import{c as te}from"./store-DH4KNu1b.js";import{a as ue}from"./http-B9ygI19o.js";import{b as U,i as me,a as I,c as E,d as he,f as V,e as X,g as fe,h as xe}from"./date-utils-BxdteZ_p.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();var ae={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ge=d,pe=Symbol.for("react.element"),be=Symbol.for("react.fragment"),ye=Object.prototype.hasOwnProperty,we=ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,je={key:!0,ref:!0,__self:!0,__source:!0};function re(t,a,o){var s,r={},i=null,n=null;o!==void 0&&(i=""+o),a.key!==void 0&&(i=""+a.key),a.ref!==void 0&&(n=a.ref);for(s in a)ye.call(a,s)&&!je.hasOwnProperty(s)&&(r[s]=a[s]);if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:pe,type:t,key:i,ref:n,props:r,_owner:we.current}}O.Fragment=be;O.jsx=re;O.jsxs=re;ae.exports=O;var e=ae.exports,H={},Y=ie;H.createRoot=Y.createRoot,H.hydrateRoot=Y.hydrateRoot;const ke="modulepreload",ve=function(t){return"/baohuriji_online/"+t},J={},N=function(a,o,s){let r=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),c=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));r=Promise.allSettled(o.map(u=>{if(u=ve(u),u in J)return;J[u]=!0;const f=u.endsWith(".css"),y=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${y}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":ke,f||(g.as="script"),g.crossOrigin="",g.href=u,c&&g.setAttribute("nonce",c),document.head.appendChild(g),f)return new Promise((L,P)=>{g.addEventListener("load",L),g.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(n){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n}return r.then(n=>{for(const c of n||[])c.status==="rejected"&&i(c.reason);return a().catch(i)})},se="https://baohuriji-api-production.workers.dev/api",K=2,Q=1e3,h=ue.create({baseURL:se,timeout:3e4,headers:{"Content-Type":"application/json"},withCredentials:!0});console.log("API Base URL:",se);h.interceptors.request.use(t=>{const a=localStorage.getItem("token");return a&&(t.headers.Authorization=`Bearer ${a}`),t},t=>Promise.reject(t));h.interceptors.response.use(t=>t.data,async t=>{var o;const a=t.config;if(t.code==="ECONNABORTED"&&t.message.includes("timeout")){if(console.error("请求超时，请检查网络连接"),a.__retryCount||(a.__retryCount=0),a.__retryCount<K)return a.__retryCount++,console.log(`重试第 ${a.__retryCount} 次...`),await new Promise(s=>setTimeout(s,Q)),h.request(a);t.message="网络请求超时，请检查网络连接后重试"}if(t.message==="Network Error"){if(console.error("网络错误，请检查网络连接"),a.__retryCount||(a.__retryCount=0),a.__retryCount<K)return a.__retryCount++,console.log(`重试第 ${a.__retryCount} 次...`),await new Promise(s=>setTimeout(s,Q)),h.request(a);t.message="网络连接失败，请检查网络后重试"}return((o=t.response)==null?void 0:o.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(t)});const T={login:async t=>{const a=await h.post("/auth/login",t);return a.token&&localStorage.setItem("token",a.token),a},register:async t=>{const a=await h.post("/auth/register",t);return a.token&&localStorage.setItem("token",a.token),a},logout:async()=>{await h.post("/auth/logout"),localStorage.removeItem("token")},getCurrentUser:async()=>await h.get("/users/me"),updateProfile:async t=>await h.put("/users/me",t),changePassword:async t=>{await h.put("/auth/change-password",t),localStorage.removeItem("token")}},M=te(t=>({user:null,isAuthenticated:!!localStorage.getItem("token"),isLoading:!1,login:async(a,o)=>{t({isLoading:!0});try{const s=await T.login({username:a,password:o});t({user:s.user,isAuthenticated:!0,isLoading:!1})}catch(s){throw t({isLoading:!1}),s}},register:async(a,o,s)=>{t({isLoading:!0});try{const r=await T.register({username:a,password:o,inviteCode:s});t({user:r.user,isAuthenticated:!0,isLoading:!1})}catch(r){throw t({isLoading:!1}),r}},logout:async()=>{try{await T.logout(),t({user:null,isAuthenticated:!1})}catch(a){console.error("Logout failed:",a),t({user:null,isAuthenticated:!1})}},fetchUser:async()=>{if(!localStorage.getItem("token")){t({isAuthenticated:!1});return}t({isLoading:!0});try{const a=await T.getCurrentUser();t({user:a,isAuthenticated:!0,isLoading:!1})}catch{t({user:null,isAuthenticated:!1,isLoading:!1}),localStorage.removeItem("token")}},updateProfile:async a=>{t({isLoading:!0});try{const o=await T.updateProfile(a);t({user:o,isLoading:!1})}catch(o){throw t({isLoading:!1}),o}},setUser:a=>{t({user:a,isAuthenticated:!!a})}})),R={createRecord:async t=>await h.post("/feeding-records",t),getRecords:async t=>await h.get("/feeding-records",{params:t}),updateRecord:async(t,a)=>await h.put(`/feeding-records/${t}`,a),deleteRecord:async t=>await h.delete(`/feeding-records/${t}`),getBabies:async()=>await h.get("/babies"),createBaby:async t=>await h.post("/babies",t),updateBaby:async(t,a)=>await h.put(`/babies/${t}`,a),deleteBaby:async t=>await h.delete(`/babies/${t}`),getDailyStats:async(t,a)=>await h.get("/stats/daily",{params:{date:t,babyId:a}}),getTrend:async t=>await h.get("/stats/trend",{params:t})},A=5*60*1e3,Ne=()=>{try{const t=localStorage.getItem("feedingStoreCache");if(t){const a=JSON.parse(t),o=Date.now();return a.recordsCache&&Object.keys(a.recordsCache).forEach(s=>{o-a.recordsCache[s].timestamp>A&&delete a.recordsCache[s]}),a.babiesCache&&o-a.babiesCache.timestamp>A&&(a.babiesCache=null),a}}catch(t){console.error("Failed to load cache from storage:",t)}return{recordsCache:{},babiesCache:null}},z=(t,a)=>{try{localStorage.setItem("feedingStoreCache",JSON.stringify({recordsCache:t,babiesCache:a}))}catch(o){console.error("Failed to save cache to storage:",o)}},q=Ne(),ne=te((t,a)=>{var o;return{babies:((o=q.babiesCache)==null?void 0:o.data)||[],babiesCache:q.babiesCache||null,currentBabyId:localStorage.getItem("currentBabyId")||null,records:[],recordsCache:q.recordsCache||{},isLoading:!1,fetchBabies:async(s=!1)=>{const r=a().babiesCache,i=Date.now();if(!s&&r&&i-r.timestamp<A){console.log("使用宝宝列表缓存"),t({babies:r.data});return}t({isLoading:!0});try{const n=await R.getBabies(),c={data:n,timestamp:i};t({babies:n,babiesCache:c,isLoading:!1}),z(a().recordsCache,c),n.length>0&&!a().currentBabyId&&(t({currentBabyId:n[0].id}),localStorage.setItem("currentBabyId",n[0].id))}catch(n){throw t({isLoading:!1}),n}},setCurrentBaby:s=>{if(a().currentBabyId===s)return;t({currentBabyId:s}),localStorage.setItem("currentBabyId",s);const r=a().recordsCache[s];t(r?{records:r.data}:{records:[]}),a().fetchRecords(s,!0)},addBaby:async s=>{t({isLoading:!0});try{const r=await R.createBaby(s);t(i=>{const n=[...i.babies,r],c={data:n,timestamp:Date.now()};return z(i.recordsCache,c),{babies:n,babiesCache:c,currentBabyId:r.id,isLoading:!1}}),localStorage.setItem("currentBabyId",r.id)}catch(r){throw t({isLoading:!1}),r}},updateBaby:async(s,r)=>{t({isLoading:!0});try{const i=await R.updateBaby(s,r);t(n=>{const c=n.babies.map(f=>f.id===s?i:f),u={data:c,timestamp:Date.now()};return z(n.recordsCache,u),{babies:c,babiesCache:u,isLoading:!1}})}catch(i){throw t({isLoading:!1}),i}},deleteBaby:async s=>{t({isLoading:!0});try{await R.deleteBaby(s),t(r=>{var f;const i=r.babies.filter(y=>y.id!==s),n=r.currentBabyId===s?((f=i[0])==null?void 0:f.id)||null:r.currentBabyId,c={data:i,timestamp:Date.now()},u={...r.recordsCache};return delete u[s],z(u,c),n?localStorage.setItem("currentBabyId",n):localStorage.removeItem("currentBabyId"),{babies:i,babiesCache:c,recordsCache:u,currentBabyId:n,isLoading:!1}})}catch(r){throw t({isLoading:!1}),r}},fetchRecords:async(s,r=!0)=>{const i=s||a().currentBabyId;if(!i)return;const n=a().recordsCache[i],c=Date.now();if(r&&n)if(c-n.timestamp<A){console.log("使用记录缓存"),t({records:n.data});return}else t({records:n.data});t({isLoading:!0});try{const u=await R.getRecords({babyId:i,limit:50});if(a().currentBabyId!==i){console.log("宝宝已切换，忽略该请求的结果"),t({isLoading:!1});return}t(y=>{const g={...y.recordsCache,[i]:{data:u,timestamp:c}};return z(g,y.babiesCache),{records:u,recordsCache:g,isLoading:!1}})}catch(u){throw t({isLoading:!1}),u}},addRecord:async s=>{t({isLoading:!0});try{const r=await R.createRecord(s);t(i=>{const n=[r,...i.records],c=r.babyId,u={...i.recordsCache,[c]:{data:n,timestamp:Date.now()}};return z(u,i.babiesCache),{records:n,recordsCache:u,isLoading:!1}})}catch(r){throw t({isLoading:!1}),r}},updateRecord:async(s,r)=>{t({isLoading:!0});try{const i=await R.updateRecord(s,r);t(n=>{const c=n.records.map(y=>y.id===s?i:y),u=i.babyId,f={...n.recordsCache,[u]:{data:c,timestamp:Date.now()}};return z(f,n.babiesCache),{records:c,recordsCache:f,isLoading:!1}})}catch(i){throw t({isLoading:!1}),i}},deleteRecord:async s=>{t({isLoading:!0});try{await R.deleteRecord(s),t(r=>{const i=r.records.filter(u=>u.id!==s),n=r.currentBabyId,c=n?{...r.recordsCache,[n]:{data:i,timestamp:Date.now()}}:r.recordsCache;return z(c,r.babiesCache),{records:i,recordsCache:c,isLoading:!1}})}catch(r){throw t({isLoading:!1}),r}},clearCache:()=>{t({recordsCache:{},babiesCache:null}),localStorage.removeItem("feedingStoreCache")}}});function Ce(){const[t,a]=d.useState(!0),[o,s]=d.useState(""),[r,i]=d.useState(""),[n,c]=d.useState(""),[u,f]=d.useState(!1),[y,g]=d.useState(""),{login:L,register:P,isLoading:B}=M(),$=ee(),F=async _=>{var D,l,k,p,w,S;_.preventDefault(),g("");try{t?await L(o,r):await P(o,r,n||void 0),$("/")}catch(m){console.error("Login/Register error:",m);let b="操作失败，请重试";m.code==="ECONNABORTED"||(D=m.message)!=null&&D.includes("超时")?b="网络请求超时，请检查网络连接后重试":m.message==="Network Error"||(l=m.message)!=null&&l.includes("网络")?b="网络连接失败，请检查网络后重试":(p=(k=m.response)==null?void 0:k.data)!=null&&p.error?b=m.response.data.error:(S=(w=m.response)==null?void 0:w.data)!=null&&S.message?b=m.response.data.message:m.message&&(b=m.message),g(b)}};return e.jsx("div",{className:"relative flex min-h-screen w-full flex-col items-center overflow-x-hidden antialiased",children:e.jsxs("div",{className:"flex w-full max-w-md flex-col px-4 pt-16 sm:px-6",children:[e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-primary/20 text-primary",children:e.jsx("span",{className:"material-symbols-outlined !text-5xl",children:"child_care"})}),e.jsx("h1",{className:"text-slate-800 dark:text-white tracking-light text-[32px] font-bold leading-tight",children:"宝贝日记"})]}),e.jsx("div",{className:"flex w-full px-0 py-8",children:e.jsxs("div",{className:"flex h-12 flex-1 items-center justify-center rounded-xl bg-slate-200 dark:bg-slate-800 p-1",children:[e.jsxs("label",{className:"flex h-full grow cursor-pointer items-center justify-center overflow-hidden rounded-lg px-2 text-sm font-medium leading-normal text-slate-500 has-[:checked]:bg-white has-[:checked]:text-slate-900 has-[:checked]:shadow-sm dark:text-slate-400 dark:has-[:checked]:bg-slate-700 dark:has-[:checked]:text-white",children:[e.jsx("span",{className:"truncate",children:"登录"}),e.jsx("input",{checked:t,onChange:()=>a(!0),className:"invisible w-0",type:"radio",name:"auth-toggle"})]}),e.jsxs("label",{className:"flex h-full grow cursor-pointer items-center justify-center overflow-hidden rounded-lg px-2 text-sm font-medium leading-normal text-slate-500 has-[:checked]:bg-white has-[:checked]:text-slate-900 has-[:checked]:shadow-sm dark:text-slate-400 dark:has-[:checked]:bg-slate-700 dark:has-[:checked]:text-white",children:[e.jsx("span",{className:"truncate",children:"注册"}),e.jsx("input",{checked:!t,onChange:()=>a(!1),className:"invisible w-0",type:"radio",name:"auth-toggle"})]})]})}),e.jsxs("form",{onSubmit:F,className:"flex w-full flex-col gap-4",children:[e.jsxs("label",{className:"flex flex-col flex-1",children:[e.jsx("p",{className:"text-slate-800 dark:text-white text-base font-medium leading-normal pb-2",children:"账号"}),e.jsx("input",{className:"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-slate-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 focus:border-primary/50 h-14 placeholder:text-slate-400 dark:placeholder:text-slate-500 p-4 text-base font-normal leading-normal",placeholder:"请输入您的账号",value:o,onChange:_=>s(_.target.value),required:!0})]}),e.jsxs("label",{className:"flex flex-col flex-1",children:[e.jsx("p",{className:"text-slate-800 dark:text-white text-base font-medium leading-normal pb-2",children:"密码"}),e.jsxs("div",{className:"relative flex w-full flex-1 items-center",children:[e.jsx("input",{className:"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-slate-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 focus:border-primary/50 h-14 placeholder:text-slate-400 dark:placeholder:text-slate-500 p-4 pr-12 text-base font-normal leading-normal",placeholder:"请输入密码",type:u?"text":"password",value:r,onChange:_=>i(_.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>f(!u),className:"absolute right-0 flex h-14 w-14 items-center justify-center text-slate-400 dark:text-slate-500",children:e.jsx("span",{className:"material-symbols-outlined",children:u?"visibility_off":"visibility"})})]})]}),!t&&e.jsxs("label",{className:"flex flex-col flex-1",children:[e.jsx("p",{className:"text-slate-800 dark:text-white text-base font-medium leading-normal pb-2",children:"家庭邀请码（非必填）"}),e.jsx("input",{className:"form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-slate-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 focus:border-primary/50 h-14 placeholder:text-slate-400 dark:placeholder:text-slate-500 p-4 text-base font-normal leading-normal",placeholder:"有邀请码则输入，无需留空",value:n,onChange:_=>c(_.target.value)})]}),y&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:y}),t&&e.jsx("div",{className:"flex w-full justify-end pt-3",children:e.jsx("a",{className:"text-primary text-sm font-medium leading-normal underline",href:"#",children:"忘记密码?"})}),e.jsx("div",{className:"flex w-full pt-8",children:e.jsx("button",{type:"submit",disabled:B,className:"flex h-14 w-full items-center justify-center rounded-xl bg-primary px-4 text-base font-bold text-white shadow-sm transition-colors hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2 dark:focus:ring-offset-background-dark disabled:opacity-50",children:B?"处理中...":t?"登录":"注册"})})]})]})})}const _e={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},Se=(t,a,o)=>{let s;const r=_e[t];return typeof r=="string"?s=r:a===1?s=r.one:s=r.other.replace("{{count}}",String(a)),o!=null&&o.addSuffix?o.comparison&&o.comparison>0?s+"内":s+"前":s},Re={full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},ze={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Pe={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Le={date:U({formats:Re,defaultWidth:"full"}),time:U({formats:ze,defaultWidth:"full"}),dateTime:U({formats:Pe,defaultWidth:"full"})};function G(t,a,o){const s="eeee p";return me(t,a,o)?s:t.getTime()>a.getTime()?"'下个'"+s:"'上个'"+s}const Ie={lastWeek:G,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:G,other:"PP p"},Ee=(t,a,o,s)=>{const r=Ie[t];return typeof r=="function"?r(a,o,s):r},Te={narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},Be={narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},De={narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},Ae={narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},Oe={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},Me={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},$e=(t,a)=>{const o=Number(t);switch(a==null?void 0:a.unit){case"date":return o.toString()+"日";case"hour":return o.toString()+"时";case"minute":return o.toString()+"分";case"second":return o.toString()+"秒";default:return"第 "+o.toString()}},Fe={ordinalNumber:$e,era:I({values:Te,defaultWidth:"wide"}),quarter:I({values:Be,defaultWidth:"wide",argumentCallback:t=>t-1}),month:I({values:De,defaultWidth:"wide"}),day:I({values:Ae,defaultWidth:"wide"}),dayPeriod:I({values:Oe,defaultWidth:"wide",formattingValues:Me,defaultFormattingWidth:"wide"})},We=/^(第\s*)?\d+(日|时|分|秒)?/i,Ue=/\d+/i,Ve={narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},qe={any:[/^(前)/i,/^(公元)/i]},He={narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},Xe={any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},Ye={narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},Je={narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},Ke={narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},Qe={any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},Ge={any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},Ze={any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},et={ordinalNumber:he({matchPattern:We,parsePattern:Ue,valueCallback:t=>parseInt(t,10)}),era:E({matchPatterns:Ve,defaultMatchWidth:"wide",parsePatterns:qe,defaultParseWidth:"any"}),quarter:E({matchPatterns:He,defaultMatchWidth:"wide",parsePatterns:Xe,defaultParseWidth:"any",valueCallback:t=>t+1}),month:E({matchPatterns:Ye,defaultMatchWidth:"wide",parsePatterns:Je,defaultParseWidth:"any"}),day:E({matchPatterns:Ke,defaultMatchWidth:"wide",parsePatterns:Qe,defaultParseWidth:"any"}),dayPeriod:E({matchPatterns:Ge,defaultMatchWidth:"any",parsePatterns:Ze,defaultParseWidth:"any"})},Z={code:"zh-CN",formatDistance:Se,formatLong:Le,formatRelative:Ee,localize:Fe,match:et,options:{weekStartsOn:1,firstWeekContainsDate:4}};function tt(){const t=ee(),{user:a}=M(),{babies:o,currentBabyId:s,records:r,setCurrentBaby:i,fetchBabies:n}=ne(),[c,u]=d.useState({formula:0,breast:0,solid:0,totalCount:0,lastFeedingTime:"",nextReminderTime:""}),[f,y]=d.useState({});d.useEffect(()=>{n()},[n]),d.useEffect(()=>{g(),L()},[r,s]);const g=d.useCallback(()=>{const l=V(new Date,"yyyy-MM-dd"),k=r.filter(x=>V(new Date(x.feedingTime),"yyyy-MM-dd")===l),p=k.filter(x=>x.feedingType==="formula").reduce((x,W)=>x+(W.amount||0),0),w=k.filter(x=>x.feedingType==="breast").length,S=k.filter(x=>x.feedingType==="solid").reduce((x,W)=>x+(W.amount||0),0),m=k[0],b=m?X(new Date(m.feedingTime),{locale:Z,addSuffix:!0}):"";u({formula:p,breast:w,solid:S,totalCount:k.length,lastFeedingTime:b,nextReminderTime:""})},[r]),L=d.useCallback(async()=>{try{const l=s||"unified",k=5*60*1e3,p=Date.now(),w=f[l],S=w&&p-w.timestamp<k;if(w&&P(w.settings),S){console.log("使用提醒设置缓存");return}const{reminderService:m}=await N(async()=>{const{reminderService:x}=await import("./reminder-uOEdt9bX.js");return{reminderService:x}},__vite__mapDeps([0,1,2,3,4])),b=await m.getSettings(s||void 0);y(x=>({...x,[l]:{settings:b,timestamp:p}})),S||P(b)}catch(l){console.error("Failed to load reminder settings:",l)}},[s,f,r]),P=d.useCallback(l=>{if(l.enabled&&r.length>0){const k=r[0];let p=new Date(k.feedingTime);p=fe(p,l.intervalHours),p=xe(p,l.intervalMinutes);const w=new Date,S=p<w;let m="";if(S){const b=Math.floor((w.getTime()-p.getTime())/36e5),x=Math.floor((w.getTime()-p.getTime())%(1e3*60*60)/(1e3*60));b>0?m=`已经超时 ${b} 小时${x>0?` ${x} 分钟`:""} 未喂养`:m=`已经超时 ${x} 分钟未喂养`}else m=X(p,{locale:Z,addSuffix:!0});u(b=>({...b,nextReminderTime:m}))}},[r]),B=d.useCallback(l=>{switch(l){case"breast":return"breastfeeding";case"formula":return"water_bottle";case"solid":return"restaurant";default:return"water_bottle"}},[]),$=d.useCallback(l=>{switch(l){case"breast":return"bg-pink-500/10 text-pink-500";case"formula":return"bg-primary/10 text-primary";case"solid":return"bg-green-500/10 text-green-500";default:return"bg-primary/10 text-primary"}},[]),F=d.useCallback(l=>{switch(l){case"breast":return"母乳";case"formula":return"配方奶";case"solid":return"辅食";default:return""}},[]),_=d.useCallback(l=>l.duration?l.duration<60?`${l.duration} 秒`:`${Math.floor(l.duration/60)} min`:l.amount?`${l.amount} ${l.unit||"ml"}`:"",[]),D=d.useMemo(()=>r.slice(0,10),[r]);return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col",children:[e.jsx("header",{className:"sticky top-0 z-10 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm pt-safe pb-3",children:e.jsxs("div",{className:"flex h-14 items-center justify-between px-4",children:[e.jsx("div",{className:"flex size-10 shrink-0 items-center justify-center",children:e.jsx("div",{className:"aspect-square size-8 rounded-full bg-cover bg-center cursor-pointer",onClick:()=>t("/settings"),style:{backgroundImage:a!=null&&a.avatarUrl?`url(${a.avatarUrl})`:`url(https://api.dicebear.com/7.x/avataaars/svg?seed=${(a==null?void 0:a.username)||"user"})`}})}),e.jsx("div",{className:"flex-grow",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"inline-flex rounded-full bg-zinc-200/80 dark:bg-zinc-800 p-1",children:o.map(l=>e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{checked:s===l.id,onChange:()=>i(l.id),className:"peer sr-only",type:"radio",name:"baby_selector"}),e.jsxs("span",{className:"flex items-center gap-1.5 rounded-full px-3 py-1.5 text-sm font-semibold text-zinc-600 dark:text-zinc-300 transition-colors peer-checked:bg-white dark:peer-checked:bg-zinc-900/80 peer-checked:text-zinc-900 dark:peer-checked:text-white",children:[e.jsx("div",{className:"size-5 rounded-full bg-cover bg-center",style:{backgroundImage:l.avatarUrl?`url(${l.avatarUrl})`:`url(https://api.dicebear.com/7.x/avataaars/svg?seed=${l.name})`}}),e.jsx("span",{children:l.name})]})]},l.id))})})}),e.jsx("div",{className:"flex size-10 items-center justify-center",children:e.jsx("button",{onClick:()=>t("/settings"),className:"flex items-center justify-center text-zinc-800 dark:text-zinc-200",children:e.jsx("span",{className:"material-symbols-outlined",children:"settings"})})})]})}),e.jsxs("main",{className:"flex-grow px-4 pb-32",children:[e.jsx("h3",{className:"pt-4 pb-2 text-lg font-bold leading-tight tracking-[-0.015em] text-zinc-900 dark:text-white",children:"今日统计"}),e.jsx("div",{className:"rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900/50 p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-600 dark:text-zinc-400",children:"今日喂养"}),e.jsxs("p",{className:"text-xl font-bold leading-tight tracking-tight text-zinc-900 dark:text-white",children:[c.formula>0&&`奶粉 ${c.formula}ml`,c.breast>0&&` + 母乳 ${c.breast}次`,c.solid>0&&` + 辅食 ${c.solid}g`,c.totalCount===0&&"暂无记录"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-600 dark:text-zinc-400",children:"喂养次数"}),e.jsxs("p",{className:"text-2xl font-bold leading-tight tracking-tight text-zinc-900 dark:text-white",children:[c.totalCount," 次"]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("p",{className:"text-sm font-medium text-zinc-600 dark:text-zinc-400",children:"上次喂养"}),e.jsx("p",{className:"text-lg font-bold leading-tight tracking-tight text-zinc-900 dark:text-white",children:c.lastFeedingTime||"暂无"})]})]}),c.nextReminderTime&&e.jsxs("div",{className:`flex items-center gap-2 mt-2 px-3 py-2 rounded-lg border ${c.nextReminderTime.includes("已经超时")?"bg-red-50 dark:bg-red-950/30 border-red-200 dark:border-red-800":"bg-primary/5 dark:bg-primary/10 border-primary/20"}`,children:[e.jsx("span",{className:`material-symbols-outlined text-lg ${c.nextReminderTime.includes("已经超时")?"text-red-500 dark:text-red-400":"text-primary"}`,children:c.nextReminderTime.includes("已经超时")?"warning":"notifications_active"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-zinc-600 dark:text-zinc-400",children:c.nextReminderTime.includes("已经超时")?"喂养提醒":"下次喂养提醒"}),e.jsx("p",{className:`text-sm font-semibold ${c.nextReminderTime.includes("已经超时")?"text-red-600 dark:text-red-400":"text-primary"}`,children:c.nextReminderTime})]})]})]})}),e.jsx("h3",{className:"pt-6 pb-2 text-lg font-bold leading-tight tracking-[-0.015em] text-zinc-900 dark:text-white",children:"最近记录"}),e.jsxs("div",{className:"space-y-3",children:[D.map(l=>e.jsxs("div",{onClick:()=>t(`/edit-record/${l.id}`),className:"flex items-center gap-4 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900/50 p-4 cursor-pointer hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors",children:[e.jsx("div",{className:`flex h-12 w-12 shrink-0 items-center justify-center rounded-full ${$(l.feedingType)}`,children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:B(l.feedingType)})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold text-zinc-800 dark:text-zinc-200",children:F(l.feedingType)}),e.jsxs("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:[V(new Date(l.feedingTime),"MM月dd日 HH:mm")," · ",l.recordedByName||"我"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:_(l)})})]},l.id)),r.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-500 dark:text-zinc-400",children:"还没有喂养记录，点击下方按钮添加"})]})]}),e.jsx("div",{className:"fixed bottom-20 right-0 left-0 z-20 flex justify-center",children:e.jsx("button",{onClick:()=>t("/add-record"),className:"flex h-14 w-14 items-center justify-center rounded-full bg-primary text-white shadow-lg shadow-primary/30",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"32px"},children:"add"})})}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-10 border-t border-zinc-200 dark:border-zinc-800 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm pb-safe",children:e.jsxs("div",{className:"grid h-16 grid-cols-3",children:[e.jsxs("button",{onClick:()=>t("/"),className:"flex flex-col items-center justify-center gap-1 text-primary dark:text-primary",children:[e.jsx("span",{className:"material-symbols-outlined",children:"home"}),e.jsx("span",{className:"text-xs font-medium",children:"主页"})]}),e.jsxs("button",{onClick:()=>t("/stats"),className:"flex flex-col items-center justify-center gap-1 text-zinc-500 dark:text-zinc-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"bar_chart"}),e.jsx("span",{className:"text-xs font-medium",children:"统计"})]}),e.jsxs("button",{onClick:()=>t("/settings"),className:"flex flex-col items-center justify-center gap-1 text-zinc-500 dark:text-zinc-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"person"}),e.jsx("span",{className:"text-xs font-medium",children:"我的"})]})]})})]})}const at=d.lazy(()=>N(()=>import("./AddRecord-CHTnfwBc.js"),__vite__mapDeps([5,1,4,2,3]))),rt=d.lazy(()=>N(()=>import("./EditRecord-DMVdV1v_.js"),__vite__mapDeps([6,1,4,2,3]))),st=d.lazy(()=>N(()=>import("./Stats-CAZ7fOf6.js"),__vite__mapDeps([7,1,4,2,3]))),nt=d.lazy(()=>N(()=>import("./Settings-D3D5oDch.js"),__vite__mapDeps([8,1,2,3,4]))),it=d.lazy(()=>N(()=>import("./BabyProfile-B-Jnxjdp.js"),__vite__mapDeps([9,1,10,4,2,3])).then(t=>({default:t.default}))),ot=d.lazy(()=>N(()=>import("./BabyProfile-B-Jnxjdp.js"),__vite__mapDeps([9,1,10,4,2,3])).then(t=>({default:t.AddBaby}))),ct=d.lazy(()=>N(()=>import("./BabyProfile-B-Jnxjdp.js"),__vite__mapDeps([9,1,10,4,2,3])).then(t=>({default:t.FamilySettings}))),lt=d.lazy(()=>N(()=>import("./BabyProfile-B-Jnxjdp.js"),__vite__mapDeps([9,1,10,4,2,3])).then(t=>({default:t.ReminderSettings}))),dt=d.lazy(()=>N(()=>import("./BabyProfile-B-Jnxjdp.js"),__vite__mapDeps([9,1,10,4,2,3])).then(t=>({default:t.EditBaby}))),ut=d.lazy(()=>N(()=>import("./AccountSettings-DHecCGAc.js"),__vite__mapDeps([11,1,10,2,3,4]))),mt=d.lazy(()=>N(()=>import("./ChangePassword-DtBBEHAj.js"),__vite__mapDeps([12,1,2,3,4])));function v({children:t}){const{isAuthenticated:a}=M();return a?e.jsx(e.Fragment,{children:t}):e.jsx(le,{to:"/login"})}function C(){return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined animate-spin text-primary",style:{fontSize:"48px"},children:"progress_activity"}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-400",children:"加载中..."})]})})}function ht(){const{isAuthenticated:t,fetchUser:a}=M(),{fetchBabies:o}=ne(),[s,r]=d.useState(!1);return d.useEffect(()=>{(async()=>{if(t&&!s)try{Promise.all([a(),o()]).then(()=>{r(!0)}).catch(n=>{console.error("Failed to initialize app:",n),r(!0)})}catch(n){console.error("Failed to initialize app:",n),r(!0)}})()},[t]),e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(j,{path:"/login",element:e.jsx(Ce,{})}),e.jsx(j,{path:"/",element:e.jsx(v,{children:e.jsx(tt,{})})}),e.jsx(j,{path:"/add-record",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(at,{})})})}),e.jsx(j,{path:"/edit-record/:id",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(rt,{})})})}),e.jsx(j,{path:"/stats",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(st,{})})})}),e.jsx(j,{path:"/settings",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(nt,{})})})}),e.jsx(j,{path:"/baby-profile",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(it,{})})})}),e.jsx(j,{path:"/add-baby",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(ot,{})})})}),e.jsx(j,{path:"/edit-baby/:id",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(dt,{})})})}),e.jsx(j,{path:"/family-settings",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(ct,{})})})}),e.jsx(j,{path:"/reminder-settings",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(lt,{})})})}),e.jsx(j,{path:"/account-settings",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(ut,{})})})}),e.jsx(j,{path:"/change-password",element:e.jsx(v,{children:e.jsx(d.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(mt,{})})})})]})})}const ft=()=>{const t=document.getElementById("loading");t&&(t.style.opacity="0",t.style.transition="opacity 0.3s",setTimeout(()=>{t.style.display="none"},300))};H.createRoot(document.getElementById("root")).render(e.jsx(de.StrictMode,{children:e.jsx(ht,{})}));setTimeout(ft,100);export{N as _,ne as a,T as b,h as c,R as f,e as j,M as u,Z as z};
