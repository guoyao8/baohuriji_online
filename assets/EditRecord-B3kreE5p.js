import{u as M,a as $,j as e}from"./index-B2L3e1xg.js";import{u as D,d as B,r as i}from"./react-vendor-CA3giask.js";import{f as g}from"./date-utils-BxdteZ_p.js";import"./store-DH4KNu1b.js";import"./http-B9ygI19o.js";function A(){const d=D(),{id:a}=B(),{user:o}=M(),{babies:j,records:x,setCurrentBaby:k,updateRecord:z,deleteRecord:N}=$(),[r,n]=i.useState("formula"),[s,u]=i.useState(150),[c,b]=i.useState(0),[f,h]=i.useState(g(new Date,"yyyy-MM-dd'T'HH:mm")),[m,p]=i.useState("");i.useEffect(()=>{const t=x.find(l=>l.id===a);t&&(n(t.feedingType),u(t.amount||""),b(t.duration||0),h(g(new Date(t.feedingTime),"yyyy-MM-dd'T'HH:mm")),p(t.babyId),k(t.babyId))},[a,x]);const v=t=>{const l=Math.floor(t/3600),C=Math.floor(t%3600/60),T=t%60;return`${l.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`},w=async()=>{if(!m||!o||!a){alert("数据不完整");return}const t={babyId:m,feedingType:r,feedingTime:f+":00",recordedBy:o.id,recordedByName:o.username};r==="breast"?(c>0&&(t.duration=c),s&&s>0&&(t.amount=s,t.unit="ml")):r==="formula"?(t.amount=s||0,t.unit="ml"):r==="solid"&&(t.amount=s||0,t.unit="斤");try{await z(a,t),d("/")}catch{alert("更新失败，请重试")}},S=async()=>{if(a&&confirm("确定要删除这条记录吗？"))try{await N(a),d("/")}catch{alert("删除失败，请重试")}},y=()=>r==="solid"?"斤":"ml";return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col",children:[e.jsx("header",{className:"sticky top-0 z-10 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm pt-safe",children:e.jsxs("div",{className:"flex h-14 items-center justify-between px-2",children:[e.jsx("div",{className:"flex size-10 items-center justify-center",children:e.jsx("button",{onClick:()=>d(-1),className:"flex items-center justify-center text-zinc-800 dark:text-zinc-200",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})}),e.jsx("h1",{className:"text-lg font-bold",children:"编辑喂养记录"}),e.jsx("div",{className:"flex size-10 items-center justify-center",children:e.jsx("button",{onClick:S,className:"flex items-center justify-center text-red-500",children:e.jsx("span",{className:"material-symbols-outlined",children:"delete"})})})]})}),e.jsxs("main",{className:"flex-grow px-4 pb-24",children:[e.jsx("div",{className:"pt-2 pb-4",children:e.jsx("div",{className:"flex h-10 flex-1 items-center justify-center rounded-lg bg-zinc-200 dark:bg-zinc-800 p-1",children:j.map(t=>e.jsxs("label",{className:"flex h-full flex-1 cursor-pointer items-center justify-center overflow-hidden rounded-md px-2 text-sm font-medium leading-normal text-zinc-500 dark:text-zinc-400 has-[:checked]:bg-white has-[:checked]:text-zinc-900 has-[:checked]:shadow-sm dark:has-[:checked]:bg-zinc-900/50 dark:has-[:checked]:text-white",children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx("input",{checked:m===t.id,onChange:()=>p(t.id),className:"invisible w-0",type:"radio",name:"baby-selector"})]},t.id))})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:"喂养类型"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>n("breast"),className:`flex flex-col items-center justify-center gap-2 rounded-xl border py-3 ${r==="breast"?"border-primary bg-primary/10 text-primary":"border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:"breastfeeding"}),e.jsx("span",{className:"text-sm font-medium",children:"母乳"})]}),e.jsxs("button",{onClick:()=>n("formula"),className:`flex flex-col items-center justify-center gap-2 rounded-xl border py-3 ${r==="formula"?"border-primary bg-primary/10 text-primary":"border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:"water_bottle"}),e.jsx("span",{className:"text-sm font-medium",children:"配方奶"})]}),e.jsxs("button",{onClick:()=>n("solid"),className:`flex flex-col items-center justify-center gap-2 rounded-xl border py-3 ${r==="solid"?"border-primary bg-primary/10 text-primary":"border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:"restaurant"}),e.jsx("span",{className:"text-sm font-medium",children:"辅食"})]})]})]}),r==="breast"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:"喂养时长"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"pointer-events-none absolute inset-y-0 left-4 flex items-center text-zinc-500 dark:text-zinc-400",children:e.jsx("span",{className:"material-symbols-outlined",children:"timer"})}),e.jsx("input",{type:"text",value:v(c),readOnly:!0,className:"w-full rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 px-12 py-3 text-center text-lg font-mono text-zinc-900 dark:text-white"})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500 dark:text-zinc-400",children:"手动输入时长（秒）："}),e.jsx("input",{type:"number",value:c,onChange:t=>b(Number(t.target.value)),className:"mt-1 w-full rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 px-4 py-3 text-zinc-900 dark:text-white"})]}),(r==="formula"||r==="solid"||r==="breast"&&typeof s=="number"&&s>0)&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:["喂养量 (",y(),")"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s,onChange:t=>u(t.target.value===""?"":Number(t.target.value)),className:"w-full rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 px-4 py-3 text-center text-2xl font-bold text-zinc-900 dark:text-white"}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-4 flex items-center text-zinc-500 dark:text-zinc-400",children:y()})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:"喂养时间"}),e.jsx("input",{type:"datetime-local",value:f,onChange:t=>h(t.target.value),className:"w-full rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 px-4 py-3 text-zinc-900 dark:text-white"})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-10 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm pb-safe",children:e.jsx("div",{className:"p-4",children:e.jsx("button",{onClick:w,className:"w-full rounded-xl bg-primary py-3.5 text-base font-bold text-white shadow-lg shadow-primary/20",children:"保存修改"})})})]})}export{A as default};
