import{u as M,a as D,j as e}from"./index-B2L3e1xg.js";import{u as B,r as c}from"./react-vendor-CA3giask.js";import{f as O}from"./date-utils-BxdteZ_p.js";import"./store-DH4KNu1b.js";import"./http-B9ygI19o.js";function H(){const h=B(),{user:f}=M(),{babies:j,currentBabyId:i,records:o,setCurrentBaby:k,addRecord:N}=D(),[n,m]=c.useState("formula"),[d,s]=c.useState(150),[p,x]=c.useState(0),[g,v]=c.useState(O(new Date,"yyyy-MM-dd'T'HH:mm")),[b,y]=c.useState(!1),[u,z]=c.useState(null),a=c.useMemo(()=>!i||!o.length?null:o.find(t=>t.babyId===i)||null,[i,o]);c.useEffect(()=>{a?(m(a.feedingType),a.feedingType==="breast"?(s(a.amount||""),x(a.duration||0)):a.feedingType==="formula"?s(a.amount||150):a.feedingType==="solid"&&s(a.amount||0)):(m("formula"),s(150),x(0))},[a,i]),c.useEffect(()=>()=>{u&&clearInterval(u)},[u]);const w=()=>{y(!0);const t=window.setInterval(()=>{x(r=>r+1)},1e3);z(t)},S=()=>{y(!1),u&&(clearInterval(u),z(null))},T=t=>{const r=Math.floor(t/3600),l=Math.floor(t%3600/60),$=t%60;return`${r.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`},C=async()=>{if(!i||!f){alert("请先选择宝宝");return}const t={babyId:i,feedingType:n,feedingTime:g+":00",recordedBy:f.id,recordedByName:f.username};n==="breast"?(p>0&&Object.assign(t,{duration:p}),d&&d>0&&Object.assign(t,{amount:d,unit:"ml"})):n==="formula"?Object.assign(t,{amount:d||0,unit:"ml"}):n==="solid"&&Object.assign(t,{amount:d||0,unit:"斤"});try{await N(t),h("/")}catch{alert("保存失败，请重试")}},I=()=>n==="solid"?"斤":"ml";return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col",children:[e.jsx("header",{className:"sticky top-0 z-10 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm pt-safe",children:e.jsxs("div",{className:"flex h-14 items-center justify-between px-2",children:[e.jsx("div",{className:"flex size-10 items-center justify-center",children:e.jsx("button",{onClick:()=>h(-1),className:"flex items-center justify-center text-zinc-800 dark:text-zinc-200",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})}),e.jsx("h1",{className:"text-lg font-bold",children:"新增喂养记录"}),e.jsx("div",{className:"flex size-10 items-center justify-center"})]})}),e.jsxs("main",{className:"flex-grow px-4 pb-24",children:[e.jsx("div",{className:"pt-2 pb-4",children:e.jsx("div",{className:"flex h-10 flex-1 items-center justify-center rounded-lg bg-zinc-200 dark:bg-zinc-800 p-1",children:j.map(t=>e.jsxs("label",{className:"flex h-full flex-1 cursor-pointer items-center justify-center overflow-hidden rounded-md px-2 text-sm font-medium leading-normal text-zinc-500 dark:text-zinc-400 has-[:checked]:bg-white has-[:checked]:text-zinc-900 has-[:checked]:shadow-sm dark:has-[:checked]:bg-zinc-900/50 dark:has-[:checked]:text-white",children:[e.jsx("input",{checked:i===t.id,onChange:r=>{r.stopPropagation(),k(t.id)},className:"invisible w-0",type:"radio",name:"baby-selector",value:t.id}),e.jsx("span",{className:"truncate",children:t.name})]},t.id))})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:"喂养类型"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:t=>{t.preventDefault(),m("breast");const r=o.find(l=>l.babyId===i&&l.feedingType==="breast");r?(s(r.amount||""),x(r.duration||0)):(s(""),x(0))},className:`flex flex-col items-center justify-center gap-2 rounded-xl border py-3 ${n==="breast"?"border-primary bg-primary/10 text-primary":"border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:"breastfeeding"}),e.jsx("span",{className:"text-sm font-medium",children:"母乳"})]}),e.jsxs("button",{type:"button",onClick:t=>{t.preventDefault(),m("formula");const r=o.find(l=>l.babyId===i&&l.feedingType==="formula");s((r==null?void 0:r.amount)||150)},className:`flex flex-col items-center justify-center gap-2 rounded-xl border py-3 ${n==="formula"?"border-primary bg-primary/10 text-primary":"border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:"water_bottle"}),e.jsx("span",{className:"text-sm font-medium",children:"配方奶"})]}),e.jsxs("button",{type:"button",onClick:t=>{t.preventDefault(),m("solid");const r=o.find(l=>l.babyId===i&&l.feedingType==="solid");s((r==null?void 0:r.amount)||0)},className:`flex flex-col items-center justify-center gap-2 rounded-xl border py-3 ${n==="solid"?"border-primary bg-primary/10 text-primary":"border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300"}`,children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:"restaurant"}),e.jsx("span",{className:"text-sm font-medium",children:"辅食"})]})]})]}),n==="breast"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:"喂养时长"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("span",{className:"pointer-events-none absolute inset-y-0 left-4 flex items-center text-zinc-500 dark:text-zinc-400",children:e.jsx("span",{className:"material-symbols-outlined",children:"timer"})}),e.jsx("input",{className:"w-full rounded-xl border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-4 pl-12 text-center text-xl font-medium text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:border-primary focus:ring-primary",placeholder:"00:00:00",value:T(p),readOnly:!0})]}),e.jsx("button",{onClick:w,disabled:b,className:`flex-shrink-0 h-14 w-14 flex items-center justify-center rounded-xl text-white shadow-sm ${b?"bg-gray-400":"bg-green-500"}`,children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:"play_arrow"})}),e.jsx("button",{onClick:S,disabled:!b,className:`flex-shrink-0 h-14 w-14 flex items-center justify-center rounded-xl text-white shadow-sm ${b?"bg-red-500":"bg-gray-400"}`,children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px"},children:"stop"})})]})]}),n!=="breast"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:"喂养量"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"w-full rounded-xl border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-4 text-center text-3xl font-bold text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:border-primary focus:ring-primary",type:"number",value:d,onChange:t=>s(t.target.value===""?"":Number(t.target.value))}),e.jsx("span",{className:"absolute inset-y-0 right-4 flex items-center text-zinc-500 dark:text-zinc-400",children:I()})]}),n==="formula"&&e.jsxs("div",{className:"mt-2 grid grid-cols-5 gap-2",children:[e.jsx("button",{onClick:()=>s(t=>Math.max(0,(t||0)-30)),className:"rounded-lg bg-zinc-200/80 dark:bg-zinc-800/80 py-2 text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"-30"}),e.jsx("button",{onClick:()=>s(t=>Math.max(0,(t||0)-10)),className:"rounded-lg bg-zinc-200/80 dark:bg-zinc-800/80 py-2 text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"-10"}),e.jsx("button",{onClick:()=>s(t=>(t||0)+10),className:"rounded-lg bg-zinc-200/80 dark:bg-zinc-800/80 py-2 text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"+10"}),e.jsx("button",{onClick:()=>s(t=>(t||0)+30),className:"rounded-lg bg-zinc-200/80 dark:bg-zinc-800/80 py-2 text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"+30"}),e.jsx("button",{className:"rounded-lg bg-zinc-200/80 dark:bg-zinc-800/80 py-2 text-sm font-medium text-zinc-700 dark:text-zinc-300",children:e.jsx("span",{className:"material-symbols-outlined text-base",children:"water_drop"})})]})]}),n==="breast"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:"喂养量 (可选)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"w-full rounded-xl border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:border-primary focus:ring-primary",placeholder:"例如: 120",type:"number",value:d===""?"":d,onChange:t=>s(t.target.value===""?"":Number(t.target.value))}),e.jsx("span",{className:"absolute inset-y-0 right-4 flex items-center text-zinc-500 dark:text-zinc-400",children:"ml"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-600 dark:text-zinc-400 mb-2",children:"喂养时间"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"pointer-events-none absolute inset-y-0 left-4 flex items-center text-zinc-500 dark:text-zinc-400",children:e.jsx("span",{className:"material-symbols-outlined",children:"schedule"})}),e.jsx("input",{className:"w-full rounded-xl border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-4 pl-12 text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:border-primary focus:ring-primary",type:"datetime-local",value:g,onChange:t=>v(t.target.value)})]})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background-light dark:bg-background-dark p-4 pb-safe-or-4 border-t border-zinc-200 dark:border-zinc-800",children:e.jsx("button",{onClick:C,className:"w-full h-12 rounded-xl bg-primary text-white font-bold text-lg flex items-center justify-center hover:bg-primary/90 transition-colors",children:"保存"})})]})}export{H as default};
